<!doctype html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <form method="post" enctype="multipart/form-data" id="form" >
        <div id="box" >
            <input class="file-input" name="selected" type="file" id="selected" />
        </div>
    </form>
    <div class="nav-box" style="margin-top:30px">
        <ul id="myTab" class="nav nav-tabs">
            <li role="presentation" class="active">
                <button  id="h5" data-toggle="tab">
                    七牛h5上传
                </button>
            </li>
        </ul>
    </div>

    <script src="../node_modules/leancloud-storage/dist/av-min.js"></script>
    <script src="../node_modules/jquery/dist/jquery.min.js"></script>
    <script>

        AV.init({
            appId: "NfptNwamDHA9VDTGMiSaSAFy-gzGzoHsz",
            appKey: "KA6pShPTmYEhxNWRulVHYcrF",
            serverURLs: "https://nfptnwam.lc-cn-n1-shared.com"
        });
        // //create data base
        // var TestObject = AV.Object.extend('Playlist');
        // //create a test object
        // var testObject = new TestObject();
        // //insert a record
        // testObject.set({
        //     name: 'test',
        //     cover: 'test',
        //     creatorId: 'test',
        //     description:'test',
        //     songs:['1','2']
        // });
        // testObject.save().then(function (testObject) {
        //     console.log('保存成功。')
        // })
        $.ajax({url: "http://192.168.0.108:9000/uptoken", success: function(res){
                var token = JSON.parse(res).uptoken
                var domain = 'q4nj29ews.bkt.clouddn.com'
                var config = {
                    useCdnDomain: true,
                    disableStatisticsReport: false,
                    retryCount: 6,
                    region: null
                };
                var putExtra = {
                    fname: "",
                    params: {},
                    mimeType: null
                };
                console.log(JSON.parse(res).uptoken)
                var uploadWithSDK = function () {
                    var subscription
                    var observable
                    var observer = {
                        next(res){
                            // ...
                        },
                        error(err){
                            // ...
                        },
                        complete(res){
                            // ...
                        }
                    }
                    var file = document.querySelector('#selected').files[0]
                    var key = file.name
                    observable = qiniu.upload(file, key, token, putExtra, config)
                    subscription = observable.subscribe(observer)
                    console.log(111)
                }
                $('#h5').click(uploadWithSDK);

            }})
    </script>
    <script src="../node_modules/qiniu-js/dist/qiniu.min.js"></script>
    <script>

    </script>
</body>
</html>
